<ng-container *ngIf="display">
  <div class="row">
    <div class="col-12">
      <nb-card>
        <nb-card-header>
          <div class="instituteBox">
            <span
              ><img
                class="my-auto float-left"
                [src]="myInstitute.institute.basicInfo.logo.secure_url"
                width="40px"
                height="40px"
                style="border-radius: 100%; border: 1px solid #000;"
            /></span>
            <span
              class="ml-3 my-auto verticalCenter"
              style="color: #ffd500; font-size: 30px; padding-top: 10px; font-weight: bold;"
            >
              {{ myInstitute.institute.basicInfo.name | uppercase }}
            </span>
            <span class="planDiv">{{ myInstitute.institute.currentPlan | uppercase }}</span>

            <span class="float-right mr-3">
              <span>Total Students: {{ totalStudents }}</span
              ><br />
              <span>Total Batches: {{ totalBatches }}</span>
            </span>
          </div>
        </nb-card-header>
      </nb-card>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-6">
      <nb-card class="card-height-1">
        <nb-card-body>
          <nb-tabset fullWidth>
            <nb-tab
              tabTitle="UPCOMING CLASSES"
              *ngIf="role === 'institute' || role === 'Manager' || role === 'Teacher'"
            >
              <div class="table-responsive" *ngIf="classes.length > 0; else noClasses">
                <table class="table table-borderless">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Course</th>
                      <th>Batch</th>
                      <th>Topic</th>
                      <th>Start Time</th>
                      <th>Teacher</th>
                    </tr>
                  </thead>
                  <tbody>
                    <ng-container *ngFor="let class of classes; let i = index">
                      <tr>
                        <td>{{ i + 1 }}</td>
                        <td>{{ class.courseName }}</td>
                        <td>{{ class.batchCode }}</td>
                        <td>{{ class.days.topic }}</td>
                        <td>
                          {{ createDate(class.days.date) }} {{ createTime(class.days.startTime) }}
                        </td>
                        <td>{{ class.teacherName | uppercase }}</td>
                      </tr>
                    </ng-container>
                  </tbody>
                </table>
              </div>
              <ng-template #noClasses>
                <p class="text-center pt-5">No Classes Today</p>
              </ng-template>
            </nb-tab>
            <nb-tab
              tabTitle="PENDING FEES"
              *ngIf="role === 'institute' || role === 'Manager' || role === 'Counselor'"
            >
              <div class="table-responsive" *ngIf="pendingFees.length > 0; else noFees">
                <table class="table table-borderless">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Student</th>
                      <th>Course</th>
                      <th>Fees</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let fees of pendingFees; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td>{{ fees.studentName }}</td>
                      <td>{{ fees.courseName }}</td>
                      <td>{{ fees.pendingAmount }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <ng-template #noFees>
                <p class="text-center pt-5">No Pending Fees</p>
              </ng-template>
            </nb-tab>
            <nb-tab
              tabTitle="STUDENT REQUESTS"
              *ngIf="role === 'institute' || role === 'Manager' || role === 'Counselor'"
            >
              <div class="table-responsive" *ngIf="studentRequest.length > 0; else noStudents">
                <table class="table table-borderless">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Name</th>
                      <th>Contact</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let req of studentRequest; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td>{{ req.studentName }}</td>
                      <td>{{ req.contact }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <ng-template #noStudents>
                <p class="text-center pt-5">No Student Requests</p>
              </ng-template>
            </nb-tab>
            <nb-tab
              tabTitle="FOLLOW UPS"
              *ngIf="role === 'institute' || role === 'Manager' || role === 'Counselor'"
            >
              <div class="table-responsive" *ngIf="newLeads.length > 0; else noLeads">
                <table class="table table-borderless">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Name</th>
                      <th>Contact</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let lead of newLeads; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td>{{ lead.leadName }}</td>
                      <td>{{ lead.leadContact }}</td>
                      <td>{{ lead.status }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <ng-template #noLeads>
                <p class="text-center pt-5">No New Leads</p>
              </ng-template>
            </nb-tab>
          </nb-tabset>
        </nb-card-body>
      </nb-card>
    </div>

    <div class="col-md-6">
      <div class="row">
        <div
          class="col-md-6"
          *ngIf="role === 'institute' || role === 'Manager' || role === 'Counselor'"
        >
          <nb-card class="card-height-2">
            <nb-card-body>
              <div class="image-container">
                <img class="inst-logo" src="../../../assets/img/add-user.png" alt="Institute" />
              </div>
              <br />
              <button
                class="btn btn-yellow"
                [routerLink]="'/pages/institute/add-students/' + this.instituteId"
              >
                ADD STUDENT
              </button>
            </nb-card-body>
          </nb-card>
        </div>

        <div
          class="col-md-6"
          *ngIf="role === 'institute' || role === 'Manager' || role === 'Counselor'"
        >
          <nb-card class="card-height-2">
            <nb-card-body>
              <div class="image-container">
                <img class="inst-logo" src="../../../assets/img/rupee.png" alt="Institute" />
              </div>
              <br />
              <button
                class="btn btn-yellow"
                [routerLink]="'/pages/institute/manage-students/' + this.instituteId"
              >
                COLLECT INSTALLMENT
              </button>
            </nb-card-body>
          </nb-card>
        </div>

        <div class="col-md-6">
          <nb-card class="card-height-2">
            <nb-card-body>
              <div class="image-container">
                <img class="inst-logo" src="../../../assets/img/home-yellow.png" alt="Institute" />
              </div>
              <br />
              <button
                class="btn btn-yellow"
                [routerLink]="'/pages/institute/add-schedule/' + this.instituteId"
              >
                ADD CLASS
              </button>
            </nb-card-body>
          </nb-card>
        </div>

        <div class="col-md-6">
          <nb-card class="card-height-2">
            <nb-card-body>
              <div class="image-container">
                <img class="inst-logo" src="../../../assets/img/calendar.png" alt="Institute" />
              </div>
              <br />
              <button
                class="btn btn-yellow"
                [routerLink]="'/pages/institute/attandance/' + this.instituteId"
              >
                ADD ATTENDANCE
              </button>
            </nb-card-body>
          </nb-card>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <nb-card>
        <nb-card-header style="background-color: #31bc9b;">
          <span style="font-size: 16px; color: #fff;">ANNOUNCEMENTS</span>
        </nb-card-header>
        <nb-card-body class="body-height-1">
          <div
            class="table-responsive"
            *ngIf="announcements && announcements.length > 0; else noAnnouncements"
          >
            <table class="table table-borderless">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Title</th>
                  <th>Date</th>
                  <th>Attachment</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let announcement of announcements; let i = index">
                  <td>{{ i + 1 }}</td>
                  <td>{{ announcement.title }}</td>
                  <td>{{ getDate(announcement.date) }}</td>
                  <td>
                    <a
                      [href]="announcement.attachment.secure_url"
                      *ngIf="announcement.attachment.secure_url; else noFile"
                    >
                      {{ announcement.attachment.file_name }} </a
                    ><ng-template #noFile>
                      <span>--</span>
                    </ng-template>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <ng-template #noAnnouncements>
            <p class="text-center pt-5">No Announcements</p>
          </ng-template>
        </nb-card-body>
      </nb-card>
    </div>

    <div class="col-md-6" *ngIf="role === 'institute' || role === 'Manager'">
      <!-- <nb-card>
        <nb-card-header>
          REVENUE AND STUDENT GRAPH
        </nb-card-header>
        <nb-card-body class="body-height-1"></nb-card-body>
      </nb-card> -->
      <nb-card>
        <nb-card-body>
          <p class="font-weight-bold">
            SMS BALANCE
          </p>
          <h2>0 SMS Pending</h2>
        </nb-card-body>
      </nb-card>
    </div>
  </div>
</ng-container>
